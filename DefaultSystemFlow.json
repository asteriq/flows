[{"id":"23e63451.6b06c43a","type":"create","z":"be568efb.fa9026b0","name":"Query Playbook","host":"https://vora-notebook-checktimeseries.app.quantiply.com","notebookName":"Vora TimeSeries","userComments":[],"x":82.25,"y":275,"edges":[["a77a4915.3ed6df64"]]},{"id":"f77bcc40.52d88183","type":"sh","z":"be568efb.fa9026b0","name":"Get Data and Load into HDFS","content":"wget http://cloud.quantiply.io/DemandData_2015_2.csv\nhadoop fs -put DemandData_2015_2.csv\nhadoop fs -ls","userComments":[],"x":287.25,"y":181,"edges":[["d57ed9b1.c1a1124f"]]},{"id":"8394123d.3eafbf39","type":"inject","z":"be568efb.fa9026b0","name":"","topic":"","message":"","messageType":"date","repeat":"","crontab":"","once":false,"userComments":[],"x":109.25,"y":212,"edges":[["23e63451.6b06c43a"]]},{"id":"a77a4915.3ed6df64","type":"spark","z":"be568efb.fa9026b0","name":"Single Column and Range","content":"sqlContext.sql(\"``SELECT ts, ND FROM national_grid_demand WHERE PERIOD AS OF TIMESTAMP '2015-09-01 00:00:00'`` USING com.sap.spark.engines\").show()","userComments":[],"x":177.25,"y":387,"edges":[["6040ef51.c8cb8b91","a3db6d14.b34eb45b","e220f726.063883b0"]]},{"id":"d57ed9b1.c1a1124f","type":"spark","z":"be568efb.fa9026b0","name":"Spark Paragraph","content":"import org.apache.spark.sql._\nval sqlContext = new SapSQLContext( sc )\n\nsqlContext.sql(s\"\"\"REGISTER ALL TABLES USING com.sap.spark.vora OPTIONS (eagerLoad \"false\")\"\"\")\n\nsqlContext.sql(\"SHOW TABLES\").show()","userComments":[],"x":248.25,"y":253,"edges":[["f9f05264.a103af7b"]]},{"id":"e220f726.063883b0","type":"spark","z":"be568efb.fa9026b0","name":"What is the overall trend in available wind and solar capacity over the year of 2015?","content":"sqlContext.sql(\"\"\"``SELECT TREND(Embedded_Wind_Capacity), TREND(Embedded_Solar_Capacity)\n  FROM national_grid_demand\n  WHERE PERIOD BETWEEN TIMESTAMP '2015-01-01 00:00:00' AND TIMESTAMP '2016-01-01 00:00:00'`` USING com.sap.spark.engines\"\"\".stripMargin).show()\n","userComments":[],"x":655.25,"y":95,"edges":[["f8fe1491.c1d4d5ab","54947808.8d11d958"]]},{"id":"f8fe1491.c1d4d5ab","type":"spark","z":"be568efb.fa9026b0","name":"Trend over the last three months","content":"sqlContext.sql(\"``SELECT TREND(ND) FROM national_grid_demand WHERE PERIOD AS OF TIMESTAMP '2015-09-01 00:00:00'`` USING com.sap.spark.engines\").show()","userComments":[],"x":641.25,"y":201,"edges":[["63bfef6b.78b1d2b3","9589cc66.c8d91c1a"]]},{"id":"63bfef6b.78b1d2b3","type":"spark","z":"be568efb.fa9026b0","name":"Supply vs. Demand","content":"sqlContext.sql(\"``SELECT median(Embedded_Solar_Generation), median(Embedded_Solar_Capacity) FROM national_grid_demand WHERE PERIOD BETWEEN TIMESTAMP '2015-08-01 00:00:00' AND TIMESTAMP '2015-09-01 00:00:00'`` USING com.sap.spark.engines\").show()\n","userComments":[],"x":597.25,"y":251,"edges":[["a246820c.dc87a4d5","8d0c2cb0.a2e445c2"]]},{"id":"a246820c.dc87a4d5","type":"spark","z":"be568efb.fa9026b0","name":"How is Wind Generation is behaving?","content":"sqlContext.sql(\"``SELECT min(Embedded_Wind_Generation) as minWG,max(Embedded_Wind_Generation) as maxWG,median(Embedded_Wind_Generation) as medWG,min(Embedded_Wind_Capacity) as minWC, max(Embedded_Wind_Capacity) as maxWC, median(Embedded_Wind_Capacity)as medWC FROM national_grid_demand WHERE PERIOD BETWEEN TIMESTAMP '2015-08-01 00:00:00' AND TIMESTAMP '2015-09-01 00:00:00'`` USING com.sap.spark.engines\").show()\n","userComments":[],"x":661.25,"y":327,"edges":[["4da9b512.ac17ee05","b690e2e4.822ace24","d897c664.cf190de8","97fe7670.2c807b6b"]]},{"id":"97fe7670.2c807b6b","type":"spark","z":"be568efb.fa9026b0","name":"how the production values deviate throughout the years?","content":"sqlContext.sql(\"``select * from HISTOGRAM ( SERIES national_grid_demand, 10, DESCRIPTOR( Embedded_Wind_Generation ) ) HIST`` USING com.sap.spark.engines\").show()\n","userComments":[],"x":655.25,"y":419,"edges":[["eb0ec6a4.a05c90be","3dc202a9.665f2610","1ca7653a.95d0f828"]]},{"id":"f9f05264.a103af7b","type":"spark","z":"be568efb.fa9026b0","name":"Create Partitions and Series Tables","content":"sqlContext.sql(\"CREATE PARTITION FUNCTION PM1(C TIMESTAMP) AS RANGE BOUNDARIES(TIMESTAMP '2015-04-01 09:00:00.0000', TIMESTAMP '2015-09-01 09:00:00.0000') USING com.sap.spark.engines\")\nsqlContext.sql(\"CREATE PARTITION SCHEME PS1 USING PM1 USING com.sap.spark.engines\")\nsqlContext.sql(s\"\"\"CREATE TABLE national_grid_demand ( ts TIMESTAMP, ND double, I014_ND double, TSD double, I014_TSD double, England_Wales_Demand double, Embedded_Wind_Generation double, Embedded_Wind_Capacity integer, Embedded_Solar_Generation double, Embedded_Solar_Capacity integer )\n    SERIES ( PERIOD FOR SERIES ts START TIMESTAMP '2015-01-01 00:00:00' END TIMESTAMP '2016-01-01 00:00:00'\n    EQUIDISTANT INCREMENT BY 30 MINUTE DEFAULT COMPRESSION use (APCA error 3.0 percent)\n    compression on (Embedded_Wind_Generation) use (SDT error 4.0 percent)\n    compression on (Embedded_Solar_Generation) use (SDT error 5.0 percent) )\n    PARTITION BY PS1( ts )\n    USING com.sap.spark.engines\n    OPTIONS (\n        files \"/user/spark/DemandData_2015_2.csv\",\n        csvskip \"1\",\n        csvdelimiter \";\",\n        storagebackend \"hdfs\")\"\"\".stripMargin)\n ","userComments":[],"x":325.25,"y":322,"edges":[["a77a4915.3ed6df64"]]},{"id":"1ca7653a.95d0f828","type":"spark","z":"be568efb.fa9026b0","name":"30 Minute Granularity","content":"sqlContext.sql(s\"\"\"``SELECT\n     ts,\n      Embedded_Wind_Generation, Embedded_Wind_Capacity,\n      Embedded_Solar_Generation, Embedded_Solar_Capacity\n    FROM\n      GRANULIZE(\n        SERIES national_grid_demand,\n        24 HOUR,\n        ROUND_HALF_UP,\n        SUM => DESCRIPTOR( Embedded_Wind_Generation, Embedded_Solar_Generation ),\n        AVG => DESCRIPTOR( Embedded_Wind_Capacity, Embedded_Solar_Capacity)  )\n    WHERE\n      PERIOD BETWEEN TIMESTAMP '2015-08-01 12:00:00'\n                 AND TIMESTAMP '2015-08-03 12:00:00'`` USING com.sap.spark.engines\"\"\".stripMargin).show()\n \n","userComments":[],"x":611.25,"y":517,"edges":[["08b77038.d0a478af","b3ba4173.4e413e8f","bbff4394.c026bfe4"]]},{"id":"bbff4394.c026bfe4","type":"spark","z":"be568efb.fa9026b0","name":"Or 15 Minute Granularity","content":"sqlContext.sql(s\"\"\"``SELECT\n      ts,\n      ND, I014_ND,\n      TSD, I014_TSD,\n      England_Wales_Demand,\n      Embedded_Wind_Generation, Embedded_Wind_Capacity,\n      Embedded_Solar_Generation, Embedded_Solar_Capacity\n    FROM\n      GRANULIZE(\n        SERIES national_grid_demand,\n        15 Minute,\n        ROUND_HALF_UP,\n        EVEN => DESCRIPTOR( ND, I014_ND ),\n        EVEN => DESCRIPTOR( TSD, I014_TSD, England_Wales_Demand ),\n        EVEN => DESCRIPTOR( Embedded_Wind_Generation, Embedded_Solar_Generation ),\n        SAME => DESCRIPTOR( Embedded_Wind_Capacity, Embedded_Solar_Capacity) )\n    WHERE\n      PERIOD BETWEEN TIMESTAMP '2015-08-01 08:00:00'\n                 AND TIMESTAMP '2015-08-01 12:00:00'`` USING com.sap.spark.engines\"\"\".stripMargin).show()\n\n","userComments":[],"x":621.25,"y":592,"edges":[["5e66a067.c58835ba","75ec89cd.ec0c8ee1","388c0442.3e55a11d"]]},{"id":"388c0442.3e55a11d","type":"spark","z":"be568efb.fa9026b0","name":"Analyze Granularized Data","content":"sqlContext.sql(s\"\"\"``SELECT\n      ts,\n      ND, I014_ND,\n      TSD, I014_TSD,\n      England_Wales_Demand,\n      Embedded_Wind_Generation, Embedded_Wind_Capacity,\n      Embedded_Solar_Generation, Embedded_Solar_Capacity\n    FROM\n      GRANULIZE(\n        SERIES national_grid_demand,\n        15 Minute,\n        ROUND_HALF_UP,\n        EVEN => DESCRIPTOR( ND, I014_ND ),\n        EVEN => DESCRIPTOR( TSD, I014_TSD, England_Wales_Demand ),\n        EVEN => DESCRIPTOR( Embedded_Wind_Generation, Embedded_Solar_Generation ),\n        SAME => DESCRIPTOR( Embedded_Wind_Capacity, Embedded_Solar_Capacity) )\n    WHERE\n      PERIOD BETWEEN TIMESTAMP '2015-08-01 08:00:00'\n                 AND TIMESTAMP '2015-08-01 12:00:00'`` USING com.sap.spark.engines\"\"\".stripMargin).show()\n\n","userComments":[],"x":625.25,"y":673,"edges":[["6640a783.a7285698","c947b5a9.7be5c121"]]},{"id":"da467b6c.65f081a6","type":"create","z":"be568efb.fa9026b0","name":"Create Vora Playbook","host":"https://vora-playbooks-tdx62.app.quantiply.com","notebookName":"Vora TimeSeries","userComments":[],"x":192.25,"y":137,"edges":[["f77bcc40.52d88183"]]},{"id":"c12a78c3.bebe1d7b","type":"inject","z":"be568efb.fa9026b0","name":"","topic":"","message":"","messageType":"date","repeat":"","crontab":"","once":false,"userComments":[],"x":151.25,"y":53,"edges":[["da467b6c.65f081a6"]]},{"id":"8d0c2cb0.a2e445c2","type":"function","z":"be568efb.fa9026b0","name":"Transformer","clusterid":"","func":" function round4(num, dec) {\n    return Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec);\n}\n \n  dataframe.message = {\n    data: [\n    {\n      id: 1,\n      name: 'Power Supply',\n      value: round4(dataframe.message.data.data[0][0],4),\n      uom: 'MWH',\n      last: 359.80\n    },\n    {\n      id: 2,\n      name: 'Total Demand',\n      value: round4(dataframe.message.data.data[0][1],4),\n      uom: 'MWH',\n      last: 12123.72\n    }\n  ]\n  };\n\nreturn dataframe;","outputs":1,"noerr":0,"userComments":[],"x":902.25,"y":283,"edges":[["8008a943.ac25f5e5"]]},{"id":"8008a943.ac25f5e5","type":"kpi","z":"be568efb.fa9026b0","name":"Supply vs. Demand KPIs","sequenceNum":1,"pulseType":"widget-multi-indicator","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1130.25,"y":324,"edges":[[]]},{"id":"54947808.8d11d958","type":"table","z":"be568efb.fa9026b0","name":"OverallTrend","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1085,"y":161,"edges":[[]]},{"id":"6040ef51.c8cb8b91","type":"table","z":"be568efb.fa9026b0","name":"ColumnRange","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":238,"y":456,"edges":[[]]},{"id":"9589cc66.c8d91c1a","type":"table","z":"be568efb.fa9026b0","name":"Last3montsh","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1102,"y":239,"edges":[[]]},{"id":"a3db6d14.b34eb45b","type":"function","z":"be568efb.fa9026b0","name":"T_ND_Dist","clusterid":"","func":"series = dataframe.message.data.data;\nvar options = {\n    xtitle: \"Time\",\n    ytitle: \"ND\",\n    legend: [\"ND\"]\n}\ndataframe.message = {\n data: [series],\n options: options\n}\nreturn dataframe;\n","outputs":1,"noerr":0,"userComments":[],"x":79,"y":452,"edges":[["6cc4513c.6405ab9e"]]},{"id":"6cc4513c.6405ab9e","type":"series","z":"be568efb.fa9026b0","name":"ND Distribution","sequenceNum":1,"pulseType":"widget-series-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":314,"y":559,"edges":[[]]},{"id":"4da9b512.ac17ee05","type":"table","z":"be568efb.fa9026b0","name":"WindGbehaviour","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":917,"y":395,"edges":[[]]},{"id":"eb0ec6a4.a05c90be","type":"table","z":"be568efb.fa9026b0","name":"ProdValues","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":828,"y":514,"edges":[[]]},{"id":"08b77038.d0a478af","type":"table","z":"be568efb.fa9026b0","name":"30Min","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":874,"y":587,"edges":[[]]},{"id":"5e66a067.c58835ba","type":"table","z":"be568efb.fa9026b0","name":"15Min","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":874,"y":663,"edges":[[]]},{"id":"6640a783.a7285698","type":"table","z":"be568efb.fa9026b0","name":"AnalyizeGData","sequenceNum":1,"pulseType":"widget-table","description":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":699,"y":753,"edges":[[]]},{"id":"b690e2e4.822ace24","type":"function","z":"be568efb.fa9026b0","name":"T_WindG","clusterid":"","func":"var data = dataframe.message.data.data;\nvar minWindG = data[0][0];\nvar maxWindG = data[0][1];\nvar medianWindG = data[0][2];\n\ndataframe.message = {\n    \"data\": [\n{x: '1',low : minWindG , q1: minWindG, median: medianWindG, q3: maxWindG, high: maxWindG}\n  ]\n}\nreturn dataframe;","outputs":1,"noerr":0,"userComments":[],"x":1208,"y":389,"edges":[["40f2fb27.dd41d659"]]},{"id":"40f2fb27.dd41d659","type":"boxplot","z":"be568efb.fa9026b0","name":"WindGenerationRange","sequenceNum":1,"pulseType":"widget-generic-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1245,"y":455,"edges":[[]]},{"id":"d897c664.cf190de8","type":"function","z":"be568efb.fa9026b0","name":"T_WindC","clusterid":"","func":"var data = dataframe.message.data.data;\nvar minWindC = data[0][3];\nvar maxWindC = data[0][4];\nvar medianWindC = data[0][5];\n\ndataframe.message = {\n    \"data\": [\n{x: '1',low : minWindC , q1: minWindC, median: medianWindC, q3: maxWindC, high: maxWindC}\n  ]\n}\nreturn dataframe;","outputs":1,"noerr":0,"userComments":[],"x":1078,"y":390,"edges":[["9ddaa323.e6531f52"]]},{"id":"9ddaa323.e6531f52","type":"boxplot","z":"be568efb.fa9026b0","name":"WindCapacityRange","sequenceNum":1,"pulseType":"widget-generic-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1028,"y":457,"edges":[[]]},{"id":"3dc202a9.665f2610","type":"function","z":"be568efb.fa9026b0","name":"T_Prod_Hist","clusterid":"","func":"var data = dataframe.message.data.data;\nvar _data = [];\ndata.map(function(item){\n    var range = Math.round(item[0]) + \"-\" + Math.round(item[1]);\n    var count = item[2];\n    _data.push([range, count]);\n});\ndataframe.message = {\n    data : [_data],\n    options: {}\n}\nreturn dataframe;","outputs":1,"noerr":0,"userComments":[],"x":970,"y":511,"edges":[["5ed680d5.35ef41cf"]]},{"id":"5ed680d5.35ef41cf","type":"column","z":"be568efb.fa9026b0","name":"ProductionValuesDistribution","sequenceNum":1,"pulseType":"widget-column-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1216,"y":556,"edges":[[]]},{"id":"b3ba4173.4e413e8f","type":"function","z":"be568efb.fa9026b0","name":"T_30Min","clusterid":"","func":"result = dataframe.message.data.data;\nwindGSeries = [];\nwindCSeries = [];\nsolarGSeries = [];\nsolarCSeries = [];\nresult.map(function(item){\n        windGSeries.push([item[0], item[1]]);\n        windCSeries.push([item[0], item[2]]);\n        solarGSeries.push([item[0], item[3]]);\n        solarCSeries.push([item[0], item[4]]);  \n})\nvar options = {\n    xtitle: \"Time\",\n    ytitle: \"Values\",\n    legend: [\"windGeneration\", \"windCapacity\", \"solarGeneration\", \"solarCapacity\"]\n}\ndataframe.message = {\n data: [windGSeries, windCSeries, solarGSeries, solarCSeries],\n options: options\n}\nreturn dataframe;\n","outputs":1,"noerr":0,"userComments":[],"x":1010,"y":588,"edges":[["3c68f0a7.368d3c3b"]]},{"id":"3c68f0a7.368d3c3b","type":"series","z":"be568efb.fa9026b0","name":"30MinGranularity","sequenceNum":1,"pulseType":"widget-series-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1169,"y":637,"edges":[[]]},{"id":"75ec89cd.ec0c8ee1","type":"function","z":"be568efb.fa9026b0","name":"T_15min","clusterid":"","func":"result = dataframe.message.data.data;\nwindGSeries = [];\nwindCSeries = [];\nsolarGSeries = [];\nsolarCSeries = [];\nresult.map(function(item){\n        windGSeries.push([item[0], item[6]]);\n        windCSeries.push([item[0], item[7]]);\n        solarGSeries.push([item[0], item[8]]);\n        solarCSeries.push([item[0], item[9]]);  \n})\nvar options = {\n    xtitle: \"Time\",\n    ytitle: \"Values\",\n    legend: [\"windGeneration\", \"windCapacity\", \"solarGeneration\", \"solarCapacity\"]\n}\ndataframe.message = {\n data: [windGSeries, windCSeries, solarGSeries, solarCSeries],\n options: options\n}\nreturn dataframe;\n","outputs":1,"noerr":0,"userComments":[],"x":1015,"y":666,"edges":[["95b7427b.8e2ca729"]]},{"id":"95b7427b.8e2ca729","type":"series","z":"be568efb.fa9026b0","name":"15MinGranularity","sequenceNum":1,"pulseType":"widget-series-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1135,"y":714,"edges":[[]]},{"id":"c947b5a9.7be5c121","type":"function","z":"be568efb.fa9026b0","name":"T_Analyzed_Data","clusterid":"","func":"result = dataframe.message.data.data;\nwindGSeries = [];\nwindCSeries = [];\nsolarGSeries = [];\nsolarCSeries = [];\nresult.map(function(item){\n        windGSeries.push([item[0], item[6]]);\n        windCSeries.push([item[0], item[7]]);\n        solarGSeries.push([item[0], item[8]]);\n        solarCSeries.push([item[0], item[9]]);  \n})\nvar options = {\n    xtitle: \"Time\",\n    ytitle: \"Values\",\n    legend: [\"windGeneration\", \"windCapacity\", \"solarGeneration\", \"solarCapacity\"]\n}\ndataframe.message = {\n data: [windGSeries, windCSeries, solarGSeries, solarCSeries],\n options: options\n}\nreturn dataframe;\n","outputs":1,"noerr":0,"userComments":[],"x":875,"y":754,"edges":[["350a5f24.7a4e78a0"]]},{"id":"350a5f24.7a4e78a0","type":"series","z":"be568efb.fa9026b0","name":"AnalyzedGranularity","sequenceNum":1,"pulseType":"widget-series-chart","description":"","xtitle":"","ytitle":"","enabled":true,"streamEnabled":false,"maxPoints":10,"userComments":[],"x":1008,"y":809,"edges":[[]]}]
